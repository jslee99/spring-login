<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title th:text="|${member.username}님의 유저 정보 페이지|">유저 정보 페이지</title>
<script th:inline="javascript">
    var isFollowing = [[${isFollowing}]];
    const following = 'following';
    const notFollowing = 'not following';
    const followingButton = 'followingButton';

    window.onload = () => {
        if(isFollowing == true){
                document.getElementById(followingButton).innerText = notFollowing;
            }else{
                document.getElementById(followingButton).innerText = following;
            }
    }

    onClickFollowingButton = (e) => {
        var url;
        if(isFollowing == true){
             url = "http://localhost:8080/user/" + [[${member.memberId}]] + "/un-follow";
        }else{
             url = "http://localhost:8080/user/" + [[${member.memberId}]] + "/follow";
        }
        fetch(url)
            .then(response => {
                return response.json();
            })
            .then(json => {
                isFollowing = json;
                if(isFollowing == true){
                    console.log("yes");
                    document.getElementById(followingButton).innerText = notFollowing;
                }else{
                    document.getElementById(followingButton).innerText = following;
                }
            })
    }
</script>
</head>
<body>
<h1 th:text="|${member.username}님의 유저 정보 페이지|">유저 정보 페이지</h1>
<hr/>



<div th:object="${member}">
    <p th:field="*{username}" th:text="|username : *{username}|"></p>
    <p th:field="*{email}" th:text="|email : *{email}|"></p>
    <p th:field="*{role}" th:text="|role : *{role}|"></p>
    <br/>
</div>
<button type="button" th:text="홈으로이동" th:onclick="|location.href='@{/}'|"></button>
<br/>
<button type="button" id="followingButton" onclick="onClickFollowingButton(this)"></button>
<br/>
<div th:replace="~{board/fragment/boardList :: boardList(boardList=${boardList})}"></div>
<hr/>
<div>팔로잉 목록</div>
<div th:replace="~{user/fragment/userList :: memberList(memberList=${followingList})}"></div>
</body>
</html>